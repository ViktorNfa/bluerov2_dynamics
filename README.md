# BlueROV2 - Koopman & Fossen Dynamics

A unified, working codebase for modeling, training, and evaluating **BlueROV2** underwater vehicle dynamics using:

- **Data-driven Koopman models (EDMDc / kernel variants)**
- **Physics-based models (Fossen-style BlueROV2 dynamics)**

The repository supports both **simulation** and **tank/recorded** datasets, with scripts for training, evaluation, and generating comparison visuals.

> ğŸ“š For background and detailed physics documentation of the BlueROV2 model, see the [README](fossen/README.md).


## âœ¨ Key Features

- **Koopman EDMDc** with configurable dictionaries (e.g., RBF) and regularization
- **Physics baseline** (Fossen-style) for apples-to-apples comparisons
- **Evaluation tooling** for one-step and multi-step RMSE
- **Open-loop rollouts & visualizations** (plots/animations)
- **ROS bag â†’ CSV helpers** for real/tank data pipelines
- Clean package layout with **editable install** for cross-module imports


## ğŸš€ Getting Started

### 1) Environment

```bash
# (Windows, macOS, Linux)
python -m venv .venv
# Windows:
.venv\Scripts\activate
# macOS/Linux:
source .venv/bin/activate

python -m pip install --upgrade pip
```

### 2) Install

You can use the ```pyproject.toml``` file and install it in editable mode as:

```bash
pip install -e .
```

This makes the code importable anywhere in the repo, e.g.

```bash
from Koopman.koopmanEDMDc import KoopmanEDMDc
# and/or
from fossen import ...
```

### 3) Dependencies

```pyproject.toml``` already install all the main dependencies, but in case it fails, the core stack is light-weight:

```bash
pip install numpy scipy scikit-learn pandas matplotlib pyyaml
```

If you plan to export MP4 animations, install ```ffmpeg``` and ensure itâ€™s on your system ```PATH```.


## ğŸ“¦ Data

**Recorded datasets** are expected as CSV files (commonly exported at **20 Hz**). Typical columns:

- **State (12)**: ```x, y, z, phi, theta, psi, u, v, w, p, q, r```.
- **Inputs**: e.g., thruster commands ```u1 ... u8``` (unused inputs can be zeroed)
- **Sampling**: constant ```dt``` (e.g., 0.05 s for 20 Hz)

Helpers for converting ROS2 bag â†’ CSV live under the ```rosbags/``` area of the repo.


## ğŸ§ª Workflows

The repository ships with ready-to-run scripts. The exact script names may vary; look inside the ```training/``` (or similarly named) folder and pick the one that matches your use case.

### A) Train on Simulation (Koopman vs. Physics)
```bash
python training/<your_sim_training_script>.py
```

- Simulates BlueROV2 trajectories.
- Fits **Koopman EDMDc** (configurable dictionary/regularization).
- Reports **one-step** and **multi-step** RMSE.
- Optionally saves an **open-loop** comparison animation under ```media/```.

### B) Train on Recorded/Tank Data
```bash
python training/<your_recorded_training_script>.py
```

- Loads the latest or specified CSV dataset.
- Trains **Koopman** and compares against **Fossen** physics.
- Reports RMSE for selected horizons (e.g., H=1, 10, 100).
- Saves figures/animations to ```media/```.


## ğŸ—‚ï¸ Repository Layout (high-level)
```graphql
.
â”œâ”€ Koopman/          # Data-driven Koopman models (EDMDc, kernels, etc.)
â”œâ”€ fossen/           # Physics-based BlueROV2 dynamics (Fossen-style)
â”œâ”€ training/         # Training & evaluation entry points (simulation/recorded)
â”œâ”€ rosbags/          # Rosbagâ†’CSV converters and (optionally) exported datasets
â”œâ”€ media/            # Plots/animations generated by scripts
â”œâ”€ configs/          # (Optional) YAML configs for paths/hyperparameters
â”œâ”€ pyproject.toml    # Editable install for clean cross-module imports
â”œâ”€ README.md         # You're here ğŸ‘‹
â””â”€ LICENSE
```

This layout allows clean imports from anywhere (after ```pip install -e .```).


## ğŸ“Š Results & Artifacts

- **Metrics**: printed to console (and optionally saved as CSV when enabled).
- **Visuals**: plots/animations written to ```media/```.
- **Reproducibility**: you can organize runs under ```experiments/YYYY-MM-DD_*``` if desired.


## ğŸ¤ Contributing

- Keep algorithm code modular (e.g., under ```Koopman/``` or ```fossen/```).
- Put run-specific logic in ```training/```.
- Add small, focused unit tests where practical.
- Use clear docstrings and type hints for new utilities.


## ğŸ“„ License

This project is released under the license specified in [LICENSE](LICENSE).


## ğŸ“£ Citation

If this work supports your research, please cite it. Example BibTeX:

```bibtex
@software{bluerov2_koopman_fossen,
  title        = {BlueROV2 Koopman and Fossen Dynamics},
  author       = {Nan Fernandez-Ayala, Victor},
  year         = {2025},
  url          = {https://github.com/KTH-DHSG/bluerov2_koopman},
  note         = {Version 0.1.0}
}
```
